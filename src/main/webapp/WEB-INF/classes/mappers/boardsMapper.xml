<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.group6.shopping.batis.BoardsDAO">
	<resultMap id="BoardsVO" type="BoardsVO">
		<result column="board_id" property="board_id"/>
		<result column="model_id" property="model_id"/>
		<result column="board_rate" property="board_rate"/>
		<result column="mem_id" property="mem_id"/>
		<result column="board_title" property="board_title"/>
		<result column="board_content" property="board_content"/>
		<result column="board_type" property="board_type"/>
		<result column="board_date" property="board_date"/>

		<collection property="specVO" resultMap="SpecVO"/>
		<collection property="modelsVO" resultMap="ModelsVO"/>
		<collection property="productsVO" resultMap="ProductsVO"/>
	</resultMap>
	<resultMap id="SpecVO" type="SpecVO">
		<result column="spec_id" property="spec_id"/>

		<result column="spec_weight" property="spec_weight"/>
		<result column="spec_price" property="spec_price"/>
		<result column="spec_processor" property="spec_processor"/>
		<result column="spec_display" property="spec_display"/>
		<result column="spec_network" property="spec_network"/>

		<result column="spec_memory" property="spec_memory"/>
		<result column="spec_color" property="spec_color"/>
	</resultMap>
	<resultMap id="ModelsVO" type="ModelsVO">
		<result column="model_id" property="model_id" />
		<result column="product_id" property="product_id" />
		<result column="model_name" property="model_name" />
	</resultMap>
	<resultMap id="ProductsVO" type="ProductsVO">
		<result column="product_id" property="product_id"/>
		<result column="product_name" property="product_name"/>
	</resultMap>


	<select id="getModelBoards" resultMap="BoardsVO">
		select * from boards b, specifications s, models m, products p
		where b.spec_id = s.spec_id and s.model_id = m.model_id and m.product_id = p.product_id
		      and b.model_id = #{modelsVO.model_id}
		order by ${cateMap.field} ${cateMap.order}
		limit #{pagingVO.numOfBoards} offset #{pagingVO.offset}
	</select>

	<select id="getNumOfBoards" resultType="int">
		select count(*)
		from boards
		where model_id = #{model_id}
	</select>

	<select id="sumOfBoardRate" resultType="int">
		select sum(board_rate)
		from boards
		where model_id = #{model_id}
	</select>
	
	<select id="avgOfBoardRate" resultType="double">
		select round(sum(board_rate) / count(*),2)
		from boards
		where model_id = #{model_id}
	</select>

	<select id="numOfBoardRate" resultType="int">
		select count(*)
		from boards
		where model_id = #{model_id}
		group by board_rate
		order by board_rate desc;
	</select>

	<select id="boardRateList" resultType="int">
		select board_rate
		from boards
		where model_id = #{model_id}
		group by board_rate
		order by board_rate desc;
	</select>

</mapper>